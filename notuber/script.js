function getPosition(){return new Promise((e,n)=>{navigator.geolocation.getCurrentPosition(e,n)})}function initUser(e){var n=new Object;n.lat=e.coords.latitude,n.lng=e.coords.longitude,n.position={lat:n.lat,lng:n.lng},n.latLng=new google.maps.LatLng(n.lat,n.lng);var t=new google.maps.Marker({animation:google.maps.Animation.DROP});return t.setPosition(n.position),n.marker=t,n}function calibrateMap(e){return map=new google.maps.Map(document.getElementById("map"),{zoom:7}),map.setCenter(e.position),e.marker.setMap(map),e.map=map,e}function initCars(e,n){var t={},o=new google.maps.InfoWindow;for(var a in t.distance=Number.POSITIVE_INFINITY,e)if(e.hasOwnProperty(a)){var i=e[a],s=(i.id,parseFloat(i.lat)),r=parseFloat(i.lng),l=(i.username,{lat:s,lng:r}),p=new google.maps.Marker({position:l,map:map,icon:"images/car.png",animation:google.maps.Animation.DROP}),c=new google.maps.LatLng(s,r),g=google.maps.geometry.spherical.computeDistanceBetween(n.latLng,c);g<t.distance&&(t.lat=s,t.lng=r,t.distance=g),p.distance=(62137e-8*g).toFixed(2),p.content="<p>This car is "+p.distance+" miles away from you. </p>",google.maps.event.addListener(p,"click",function(){o.setOptions({content:this.content}),o.open(n.map,this)})}return n.closestDistance=(62137e-8*t.distance).toFixed(2),n.closestCoords=[n.position,{lat:t.lat,lng:t.lng}],n}function callAPI(e){var n=new XMLHttpRequest,t="username=xIHNcana&lat="+e.lat+"&lng="+e.lng;n.open("POST","https://jordan-marsh.herokuapp.com/rides",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&initInfoWindow(drawLine(initCars(JSON.parse(n.responseText),e)))},n.send(t)}function drawLine(e){return new google.maps.Polyline({path:e.closestCoords,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(e.map),e}function initInfoWindow(e){var n="<h1>You are here</h1><p>The closest car to you is "+e.closestDistance+" miles away. </p>",t=new google.maps.InfoWindow({content:n,position:e.position});e.marker.addListener("click",function(){t.open(e.map,e.marker)})}function initMap(){getPosition().then(e=>initUser(e)).then(e=>calibrateMap(e)).then(e=>callAPI(e))}